<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CWF - ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏£‡πå</title>
  <link rel="stylesheet" href="style.css">
  <link rel="manifest" href="/mainfest.json">
  <meta name="theme-color" content="#0b4bb3">
  <style>
    /* page-local premium tweaks (no regression to other pages) */
    :root{
      --iq-text:#0f172a;
      --iq-muted:#475569;
      --iq-border:rgba(15,23,42,.10);
      --iq-surface:rgba(255,255,255,.86);
      --iq-surface2:rgba(255,255,255,.70);
      --iq-primary:#0b4bb3;
      --iq-primary2:#2f7cff;
      --iq-shadow:0 12px 34px rgba(2,6,23,.10);
    }
    .iq-wrap{max-width:980px;margin:0 auto;padding:14px 14px 140px;}
    .iq-steps{display:flex;flex-direction:column;gap:12px;}
    .iq-step{border:1px solid var(--iq-border); box-shadow: var(--iq-shadow);}
    .iq-step h2{margin:0 0 10px 0;font-size:18px;color:var(--iq-text);}
    .iq-grid{display:grid;grid-template-columns:1fr;gap:10px;}
    .iq-grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
    .iq-chiprow{display:flex;flex-wrap:wrap;gap:8px;}
    .iq-chip{
      border:1px solid var(--iq-border);
      background:var(--iq-surface2);
      color:var(--iq-text);
      padding:10px 12px;
      border-radius:999px;
      font-weight:800;
      font-size:14px;
      cursor:pointer;
      user-select:none;
      box-shadow:0 8px 22px rgba(2,6,23,.06);
    }
    .iq-chip[aria-pressed="true"]{
      background:linear-gradient(180deg, rgba(11,75,179,.14), rgba(47,124,255,.10));
      border-color:rgba(47,124,255,.40);
      color:var(--iq-text);
      box-shadow:0 10px 24px rgba(11,75,179,.16);
    }
    .iq-sub{color:var(--iq-muted);font-size:12px;line-height:1.35;}
    .iq-badge{display:inline-flex;gap:8px;align-items:center;padding:8px 10px;border-radius:12px;background:var(--iq-surface2);border:1px solid var(--iq-border);}
    .iq-badge b{font-size:14px;color:var(--iq-text);}
    .iq-kpi{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
    .iq-kpi .k{padding:12px;border-radius:14px;background:var(--iq-surface);border:1px solid var(--iq-border);}
    .iq-kpi .k .t{font-size:12px;color:var(--iq-muted)}
    .iq-kpi .k .v{margin-top:6px;font-size:18px;font-weight:950;color:var(--iq-text)}
    .iq-table{width:100%;border-collapse:collapse;}
    .iq-table td{padding:8px 6px;border-bottom:1px solid var(--iq-border);vertical-align:top;color:var(--iq-text)}
    .iq-table td:last-child{text-align:right;font-weight:900}
    .iq-hr{height:1px;background:var(--iq-border);margin:10px 0;}
    .iq-actions{display:flex;gap:10px;flex-wrap:wrap;}
    .iq-actions .primary{flex:1;min-width:180px;}
    .iq-actions .secondary{flex:1;min-width:180px;}
    .iq-note{padding:12px;border-radius:14px;background:rgba(255,196,0,.18);border:1px solid rgba(255,196,0,.28);}
    .iq-note b{color:#7c5a00;}
    .iq-error{display:none;margin-top:10px;padding:10px 12px;border-radius:12px;background:rgba(255,59,59,.12);border:1px solid rgba(255,59,59,.25);color:var(--iq-text)}
    .iq-error.show{display:block;}
    .iq-muted{color:var(--iq-muted)}
    /* improve default form contrast inside theme-2 */
    .iq-step .label{color:var(--iq-text)}
    .iq-step input, .iq-step select{background:rgba(255,255,255,.92); color:var(--iq-text); border:1px solid var(--iq-border);}
    .iq-step input::placeholder{color:rgba(71,85,105,.75)}
    .iq-step .primary{background:linear-gradient(180deg, #0b4bb3, #0a3f97); border:0;}
    .iq-step .secondary{background:rgba(255,255,255,.80); color:var(--iq-text); border:1px solid var(--iq-border);}
    .iq-step .secondary:hover{filter:brightness(.98)}
    .iq-step .primary:hover{filter:brightness(1.02)}
    @media (min-width: 860px){
      .iq-grid2{grid-template-columns:1fr 1fr;}
      .iq-kpi{grid-template-columns:1fr 1fr 1fr 1fr;}
    }
  
    /* Phase 7 premium: stronger readability + wow */
    body.theme-2{background: radial-gradient(1200px 800px at 20% -10%, rgba(47,124,255,.22), transparent 55%),
                          radial-gradient(900px 700px at 90% 0%, rgba(255,196,0,.16), transparent 50%),
                          linear-gradient(180deg, rgba(248,250,252,1), rgba(241,245,249,1));}
    .topbar{backdrop-filter:saturate(140%) blur(10px); background:rgba(255,255,255,.72); border-bottom:1px solid var(--iq-border);}
    .topbar .title b{color:var(--iq-text);}
    .topbar .title .muted{color:var(--iq-muted); opacity:1;}
    .iq-hero{padding:14px 14px 12px;}
    .iq-hero h1{margin:0;font-size:20px;letter-spacing:-.2px;color:var(--iq-text);}
    .iq-hero p{margin:6px 0 0 0;color:var(--iq-muted);font-size:13px;line-height:1.45;}
    .iq-pillrow{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px;}
    .iq-pill{display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border-radius:999px;background:rgba(255,255,255,.80);border:1px solid var(--iq-border);color:var(--iq-text);font-weight:800;font-size:12px;}
    .iq-pill b{font-weight:950;}
    .iq-pill .dot{width:8px;height:8px;border-radius:999px;background:rgba(34,197,94,.9);box-shadow:0 0 0 3px rgba(34,197,94,.18);}
    .iq-kpi{margin-top:12px;grid-template-columns:repeat(2,1fr);}
    .iq-kpi .k{box-shadow:0 10px 24px rgba(2,6,23,.06);}
    .iq-kpi .k .t{color:var(--iq-muted);opacity:1;font-weight:800;}
    .iq-kpi .k .v{font-size:20px;}
    .iq-step{overflow:hidden;}
    .iq-step h2{display:flex;align-items:center;gap:10px;}
    .iq-step h2:before{content:"";width:10px;height:10px;border-radius:6px;background:linear-gradient(180deg,var(--iq-primary2),var(--iq-primary));box-shadow:0 8px 18px rgba(11,75,179,.25);}
    .iq-sub{opacity:1;}
    .iq-note{background:rgba(255,196,0,.16);}
    .iq-stickybar{
      position:fixed; left:12px; right:12px; bottom:calc(12px + env(safe-area-inset-bottom));
      z-index:50;
      display:flex; gap:10px; align-items:center; justify-content:space-between;
      padding:8px 10px; border-radius:16px;
      background:rgba(255,255,255,.85);
      border:1px solid var(--iq-border);
      box-shadow:0 16px 38px rgba(2,6,23,.14);
      backdrop-filter:saturate(140%) blur(10px);
    }
    .iq-stickybar .sum{display:flex;flex-direction:column;gap:2px;min-width:0;}
    .iq-stickybar .sum .line{display:flex;gap:8px;flex-wrap:wrap;align-items:baseline;color:var(--iq-muted);font-size:12px;}
    .iq-stickybar .sum b{color:var(--iq-text);font-size:16px;letter-spacing:-.2px;}
    .iq-stickybar .btns{display:flex;gap:8px;flex:0 0 auto;}
    .iq-stickybar button{border-radius:14px;padding:10px 12px;font-weight:950;}
    .iq-stickybar .secondary{min-width:92px;}
    .iq-stickybar .primary{min-width:138px;}
    .iq-wrap{padding-bottom:92px;} /* room for stickybar */
    .iq-minihelp{margin-top:12px;padding:12px;border-radius:16px;background:rgba(11,75,179,.06);border:1px solid rgba(11,75,179,.16);}
    .iq-minihelp b{color:var(--iq-text);}
    .iq-checklist{margin:10px 0 0 0;padding:0;list-style:none;display:grid;gap:8px;}
    .iq-checklist li{display:flex;gap:10px;align-items:flex-start;color:var(--iq-text);}
    .iq-checklist .tick{width:18px;height:18px;border-radius:6px;background:rgba(34,197,94,.14);border:1px solid rgba(34,197,94,.25);display:flex;align-items:center;justify-content:center;color:rgba(22,101,52,1);font-weight:950;flex:0 0 auto;}
    @media (min-width: 860px){
      .iq-kpi{grid-template-columns:repeat(4,1fr);}
      .iq-hero h1{font-size:22px;}
      .iq-stickybar{left:calc(50% - 490px); right:calc(50% - 490px);}
    }

    .iq-stickybar .toggle{
      border:1px solid var(--iq-border);
      background:rgba(255,255,255,.7);
      color:var(--iq-text);
      width:34px;height:34px;border-radius:12px;
      display:grid;place-items:center;
      box-shadow:0 10px 24px rgba(2,6,23,.08);
      cursor:pointer;
    }
    .iq-stickybar.collapsed .sum .line:nth-child(2){display:none;}
    .iq-stickybar.collapsed{padding:8px 10px;}
    @media (max-width:420px){
      .iq-stickybar .sum .line:nth-child(2){display:none;}
      .iq-stickybar .btns button{padding:10px 12px; font-size:13px;}
    }
    
  </style>
</head>
<body class="theme-2">
  <div class="app">
    <div class="topbar">
      <div class="brand">
        <img src="/logo.png" alt="CWF">
        <div class="title">
          <b>üßÆ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏£‡πå (‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤)</b>
          <span class="muted">Coldwindflow air services</span>
        </div>
      </div>
      <div class="top-actions">
        <button class="secondary" type="button" onclick="location.href='/customer'">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß</button>
        <button class="secondary top-track" type="button" onclick="location.href='/track.html'">üîé ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏á‡∏≤‡∏ô</button>
      </div>
    </div>

    <div class="iq-wrap">
      
      <div class="card iq-step iq-hero">
        <h1>‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏£‡πå‡πÅ‡∏ö‡∏ö ‚Äú‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™‚Äù</h1>
        <p>‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡πà‡∏≤‡∏ß ‡πÜ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÅ‡∏¢‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏ä‡∏±‡∏î: ‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô + ‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡∏à‡∏≤‡∏Å‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô + ‡∏á‡∏≤‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏© (‡∏Ñ‡∏¥‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å/‡πÄ‡∏Å‡∏¥‡∏ô‡∏à‡∏£‡∏¥‡∏á)</p>
        <div class="iq-pillrow" aria-label="trust pills">
          <div class="iq-pill"><span class="dot"></span>‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏™‡∏£‡∏∏‡∏õ‡∏™‡πà‡∏á‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</div>
          <div class="iq-pill">‡∏Ñ‡∏¥‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞ ‚Äú‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‚Äù ‡∏à‡∏≤‡∏Å‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô</div>
          <div class="iq-pill">‡∏ä‡πà‡∏≤‡∏á‡∏°‡∏µ‡πÉ‡∏ö‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏á‡∏≤‡∏ô‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á ‡πÅ‡∏•‡∏∞‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ö‡∏£‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏à‡∏≤‡∏Å‡∏Å‡∏£‡∏°‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ù‡∏µ‡∏°‡∏∑‡∏≠‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô</div>
        </div>

        <div class="iq-kpi">
          <div class="k">
            <div class="t">‡∏£‡∏ß‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</div>
            <div id="kpi_per" class="v">-</div>
          </div>
          <div class="k">
            <div class="t">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
            <div id="kpi_grand" class="v">-</div>
          </div>
          <div class="k">
            <div class="t">BTU ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</div>
            <div id="kpi_btu" class="v">-</div>
          </div>
          <div class="k">
            <div class="t">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</div>
            <div id="kpi_count" class="v">1</div>
          </div>
        </div>

        <div class="iq-minihelp">
          <b>‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏ó‡∏µ‡πà ‚Äú‡∏£‡∏ß‡∏°‡πÅ‡∏•‡πâ‡∏ß‚Äù ‡∏ï‡πà‡∏≠ 1 ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</b>
          <ul class="iq-checklist">
            <li><span class="tick">‚úì</span><span>‡∏ó‡πà‡∏≠‡∏ô‡πâ‡∏≥‡∏¢‡∏≤ 4 ‡πÄ‡∏°‡∏ï‡∏£ ‚Ä¢ ‡∏™‡∏≤‡∏¢‡πÑ‡∏ü 8 ‡πÄ‡∏°‡∏ï‡∏£ ‚Ä¢ ‡∏ó‡πà‡∏≠‡∏ô‡πâ‡∏≥‡∏ó‡∏¥‡πâ‡∏á 8 ‡πÄ‡∏°‡∏ï‡∏£ ‚Ä¢ ‡∏£‡∏≤‡∏á‡∏Ñ‡∏£‡∏≠‡∏ö‡∏ó‡πà‡∏≠ 4 ‡πÄ‡∏°‡∏ï‡∏£</span></li>
            <li><span class="tick">‚úì</span><span>‡πÄ‡∏ö‡∏£‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå 1 ‡∏ä‡∏∏‡∏î ‚Ä¢ ‡∏Ç‡∏≤‡∏¢‡∏≤‡∏á‡∏£‡∏≠‡∏á ‡πÅ‡∏•‡∏∞‡∏Ç‡∏≤‡πÄ‡∏´‡∏•‡πá‡∏Å‡∏ä‡∏∏‡∏î‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô</span></li>
          </ul>
          <div class="iq-sub" style="margin-top:8px;">* ‡πÄ‡∏õ‡πá‡∏ô ‚Äú‡∏£‡∏≤‡∏Ñ‡∏≤‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‚Äù ‡∏ï‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô ‡∏´‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏á‡∏≤‡∏ô‡∏°‡∏µ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏û‡∏¥‡πÄ‡∏®‡∏© ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏à‡∏∞‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div>
        </div>
      </div>


      <div class="iq-steps">
        <div class="card iq-step">
          <h2>Step 1: ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÅ‡∏≠‡∏£‡πå</h2>
          <div class="iq-chiprow" role="group" aria-label="ac type">
            <button class="iq-chip" type="button" data-ac-type="‡∏ï‡∏¥‡∏î‡∏ú‡∏ô‡∏±‡∏á" aria-pressed="true">‡∏ï‡∏¥‡∏î‡∏ú‡∏ô‡∏±‡∏á</button>
            <button class="iq-chip" type="button" data-ac-type="‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏Ç‡∏ß‡∏ô" aria-pressed="false">‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏Ç‡∏ß‡∏ô</button>
            <button class="iq-chip" type="button" data-ac-type="4‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á" aria-pressed="false">4 ‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á</button>
          </div>
          <div class="iq-sub" style="margin-top:8px;">* ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÅ‡∏≠‡∏£‡πå‡∏°‡∏µ‡∏ú‡∏•‡∏ï‡πà‡∏≠ ‚Äú‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏£‡∏∏‡∏õ‚Äù (‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏¢‡∏∂‡∏î‡∏ï‡∏≤‡∏° BTU ‡πÅ‡∏•‡∏∞‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô)</div>
        </div>

        <div class="card iq-step">
          <h2>Step 2: ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</h2>
          <div class="iq-grid" style="align-items:start;">
            <div class="machine-box" style="max-width:360px;">
              <div class="label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</div>
              <input id="machine_count" type="hidden" value="1">
              <div class="stepper" aria-label="machine count" style="margin-top:8px;">
                <button id="mc_minus" class="btn-round" type="button" aria-label="‡∏•‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô">‚àí</button>
                <div id="mc_value" class="value">1</div>
                <button id="mc_plus" class="btn-round" type="button" aria-label="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô">+</button>
              </div>
              <div class="iq-sub" style="margin-top:8px;">* ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏Ñ‡∏π‡∏ì ‚Äú‡∏£‡∏ß‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‚Äù ‡πÄ‡∏õ‡πá‡∏ô ‚Äú‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‚Äù ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</div>
            </div>
          </div>
        </div>

        <div class="card iq-step">
          <h2>Step 3: BTU</h2>
          <div class="iq-grid">
            <div class="iq-chiprow" role="group" aria-label="btu mode">
              <button class="iq-chip" type="button" data-btu-mode="manual" aria-pressed="true">‡∏Å‡∏£‡∏≠‡∏Å BTU ‡πÄ‡∏≠‡∏á</button>
              <button class="iq-chip" type="button" data-btu-mode="room" aria-pressed="false">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å‡∏Ç‡∏ô‡∏≤‡∏î‡∏´‡πâ‡∏≠‡∏á</button>
            </div>

            <div id="btu_manual_box" class="iq-grid2" style="margin-top:6px;">
              <div>
                <div class="label">BTU</div>
                <input id="btu_input" inputmode="numeric" placeholder="‡πÄ‡∏ä‡πà‡∏ô 12000" />
                <div class="iq-sub" style="margin-top:6px;">* ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÉ‡∏ä‡πâ BTU ‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏ó‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô</div>
              </div>
              <div>
                <div class="label">‡∏õ‡∏±‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏õ‡πá‡∏ô BTU ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô</div>
                <div class="iq-badge" style="margin-top:8px;">
                  <span class="iq-muted">‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</span>
                  <b id="btu_norm_badge">-</b>
                </div>
                <button id="use_norm_btu" class="secondary" type="button" style="margin-top:10px;">‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤ BTU ‡∏ô‡∏µ‡πâ</button>
              </div>
            </div>

            <div id="btu_room_box" class="iq-grid" style="display:none;margin-top:6px;">
              <div class="iq-chiprow" role="group" aria-label="room input mode" style="margin-top:2px;">
                <button class="iq-chip" type="button" data-room-mode="area" aria-pressed="true">‡∏Å‡∏£‡∏≠‡∏Å‡∏ï‡∏£.‡∏°.</button>
                <button class="iq-chip" type="button" data-room-mode="wh" aria-pressed="false">‡∏Å‡∏£‡∏≠‡∏Å‡∏Å‡∏ß‡πâ‡∏≤‡∏á √ó ‡∏¢‡∏≤‡∏ß</button>
              </div>

              <div class="iq-grid2" style="margin-top:6px;">
                <div id="room_area_box">
                  <div class="label">‡∏Ç‡∏ô‡∏≤‡∏î‡∏´‡πâ‡∏≠‡∏á (‡∏ï‡∏£.‡∏°.)</div>
                  <input id="room_area" inputmode="decimal" placeholder="‡πÄ‡∏ä‡πà‡∏ô 20" />
                  <div class="iq-sub" style="margin-top:6px;">* ‡∏ñ‡πâ‡∏≤‡∏£‡∏π‡πâ‡πÄ‡∏õ‡πá‡∏ô ‚Äú‡∏Å‡∏ß‡πâ‡∏≤‡∏á√ó‡∏¢‡∏≤‡∏ß‚Äù ‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏´‡∏°‡∏î‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô</div>
                </div>

                <div id="room_wh_box" style="display:none;">
                  <div class="label">‡∏Å‡∏ß‡πâ‡∏≤‡∏á √ó ‡∏¢‡∏≤‡∏ß (‡πÄ‡∏°‡∏ï‡∏£)</div>
                  <div class="iq-grid2" style="gap:8px;">
                    <input id="room_w" inputmode="decimal" placeholder="‡∏Å‡∏ß‡πâ‡∏≤‡∏á" />
                    <input id="room_l" inputmode="decimal" placeholder="‡∏¢‡∏≤‡∏ß" />
                  </div>
                  <div class="iq-sub" style="margin-top:6px;">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</div>
                  <div class="iq-badge" style="margin-top:8px;"><span class="iq-muted">‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà:</span><b id="room_area_calc">-</b></div>
                </div>

                <div>
                  <div class="label">‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏´‡πâ‡∏≠‡∏á</div>
                  <select id="room_factor">
                    <option value="700">‡∏õ‡∏Å‡∏ï‡∏¥</option>
                    <option value="800">‡πÇ‡∏î‡∏ô‡πÅ‡∏î‡∏î/‡∏´‡πâ‡∏≠‡∏á‡∏£‡πâ‡∏≠‡∏ô</option>
                    <option value="900">‡πÄ‡∏û‡∏î‡∏≤‡∏ô‡∏™‡∏π‡∏á/‡∏Ñ‡∏ô‡πÄ‡∏¢‡∏≠‡∏∞</option>
                  </select>
                </div>
              </div>

              <div class="iq-note" style="margin-top:8px;">
                <div><b>BTU ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</b> (‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà √ó ‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢)</div>
                <div style="margin-top:8px;display:flex;gap:10px;align-items:center;flex-wrap:wrap;">
                  <div class="iq-badge"><span class="iq-muted">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÑ‡∏î‡πâ:</span><b id="btu_raw">-</b></div>
                  <div class="iq-badge"><span class="iq-muted">‡∏õ‡∏±‡∏î‡πÄ‡∏õ‡πá‡∏ô:</span><b id="btu_norm">-</b></div>
                  <button id="use_room_btu" class="primary" type="button">‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤ BTU ‡∏ô‡∏µ‡πâ</button>
                </div>
              </div>
            </div>

            <div id="btu_warn" class="iq-error">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà BTU (‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å‡∏Ç‡∏ô‡∏≤‡∏î‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î ‚Äú‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤ BTU ‡∏ô‡∏µ‡πâ‚Äù)</div>
          </div>
        </div>

        <div class="card iq-step">
          <h2>Step 4: ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡πà‡∏≠‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì (‡∏ï‡πà‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á)</h2>
          <div class="iq-sub">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏Ñ‡∏¥‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞ ‚Äú‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡∏à‡∏≤‡∏Å‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‚Äù (‡∏ó‡πà‡∏≠‡∏ô‡πâ‡∏≥‡∏¢‡∏≤ 4m / ‡∏™‡∏≤‡∏¢‡πÑ‡∏ü 8m / ‡∏ó‡πà‡∏≠‡∏ô‡πâ‡∏≥‡∏ó‡∏¥‡πâ‡∏á 8m / ‡∏£‡∏≤‡∏á‡∏Ñ‡∏£‡∏≠‡∏ö‡∏ó‡πà‡∏≠ 4m)</div>
          <div class="iq-grid2" style="margin-top:10px;">
            <div>
              <div class="label">‡∏ó‡πà‡∏≠‡∏ô‡πâ‡∏≥‡∏¢‡∏≤ (m)</div>
              <input id="len_ref" inputmode="decimal" placeholder="‡πÄ‡∏ä‡πà‡∏ô 6" />
            </div>
            <div>
              <div class="label">‡∏™‡∏≤‡∏¢‡πÑ‡∏ü (m)</div>
              <input id="len_power" inputmode="decimal" placeholder="‡πÄ‡∏ä‡πà‡∏ô 12" />
            </div>
            <div>
              <div class="label">‡∏ó‡πà‡∏≠‡∏ô‡πâ‡∏≥‡∏ó‡∏¥‡πâ‡∏á (m)</div>
              <input id="len_drain" inputmode="decimal" placeholder="‡πÄ‡∏ä‡πà‡∏ô 10" />
              <div class="iq-sub" style="margin-top:6px;">* ‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ñ‡∏¥‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏° (‡∏ä‡πà‡∏ß‡∏á 30‚Äì50 ‡∏ö‡∏≤‡∏ó/‡∏°.) ‚Äî ‡∏Ñ‡∏¥‡∏î‡∏à‡∏£‡∏¥‡∏á‡∏î‡πâ‡∏ß‡∏¢ STD 40 ‡∏ö‡∏≤‡∏ó/‡∏°.</div>
            </div>
            <div>
              <div class="label">‡∏£‡∏≤‡∏á‡∏Ñ‡∏£‡∏≠‡∏ö‡∏ó‡πà‡∏≠ (m)</div>
              <input id="len_trunk" inputmode="decimal" placeholder="‡πÄ‡∏ä‡πà‡∏ô 6" />
            </div>
          </div>
        </div>

        <div class="card iq-step">
          <h2>Step 5: ‡∏á‡∏≤‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©/‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏û‡∏¥‡πà‡∏° (‡∏ï‡πà‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á)</h2>
          <div class="iq-grid">
            <div class="iq-grid2">
              <div>
                <label style="display:flex;gap:10px;align-items:center;">
                  <input id="chk_wall_chase" type="checkbox" style="transform:scale(1.2);">
                  <b>‡∏Å‡∏£‡∏µ‡∏î‡∏ú‡∏ô‡∏±‡∏á‡∏ù‡∏±‡∏á‡∏ó‡πà‡∏≠</b>
                </label>
                <input id="wall_chase_m" inputmode="decimal" placeholder="‡πÄ‡∏°‡∏ï‡∏£" disabled>
                <div class="iq-sub">300 ‡∏ö‡∏≤‡∏ó/‡πÄ‡∏°‡∏ï‡∏£</div>
              </div>

              <div>
                <label style="display:flex;gap:10px;align-items:center;">
                  <input id="chk_ceiling_run" type="checkbox" style="transform:scale(1.2);">
                  <b>‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡πà‡∏≠‡∏Ç‡∏∂‡πâ‡∏ô‡∏ù‡πâ‡∏≤</b>
                </label>
                <input id="ceiling_run_m" inputmode="decimal" placeholder="‡πÄ‡∏°‡∏ï‡∏£" disabled>
                <div class="iq-sub">300 ‡∏ö‡∏≤‡∏ó/‡πÄ‡∏°‡∏ï‡∏£</div>
              </div>
            </div>

            <div class="iq-grid2">
              <div>
                <label style="display:flex;gap:10px;align-items:center;">
                  <input id="chk_thick_insulation" type="checkbox" style="transform:scale(1.2);" disabled>
                  <b>‡∏â‡∏ô‡∏ß‡∏ô‡∏´‡∏ô‡∏≤‡∏û‡∏¥‡πÄ‡∏®‡∏© (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡∏∂‡πâ‡∏ô‡∏ù‡πâ‡∏≤)</b>
                </label>
                <input id="thick_insulation_m" inputmode="decimal" placeholder="‡πÄ‡∏°‡∏ï‡∏£" disabled>
                <div class="iq-sub">200 ‡∏ö‡∏≤‡∏ó/‡πÄ‡∏°‡∏ï‡∏£</div>
              </div>

              <div>
                <label style="display:flex;gap:10px;align-items:center;">
                  <input id="chk_misc_parts" type="checkbox" style="transform:scale(1.2);">
                  <b>‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠/‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏™‡∏£‡∏¥‡∏°</b>
                </label>
                <input id="misc_parts_qty" inputmode="numeric" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏¥‡πâ‡∏ô" disabled>
                <div class="iq-sub">100 ‡∏ö‡∏≤‡∏ó/‡∏ä‡∏¥‡πâ‡∏ô</div>
              </div>
            </div>

            <div class="iq-grid2">
              <div>
                <label style="display:flex;gap:10px;align-items:center;">
                  <input id="chk_wire_tray" type="checkbox" style="transform:scale(1.2);">
                  <b>‡∏£‡∏≤‡∏á‡∏Ñ‡∏£‡∏≠‡∏ö‡∏™‡∏≤‡∏¢‡πÑ‡∏ü</b>
                </label>
                <input id="wire_tray_m" inputmode="decimal" placeholder="‡πÄ‡∏°‡∏ï‡∏£" disabled>
                <div class="iq-sub">50 ‡∏ö‡∏≤‡∏ó/‡πÄ‡∏°‡∏ï‡∏£</div>
              </div>
              <div>
                <label style="display:flex;gap:10px;align-items:center;">
                  <input id="chk_pvc" type="checkbox" style="transform:scale(1.2);">
                  <b>‡∏ó‡πà‡∏≠ PVC ‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß</b>
                </label>
                <input id="pvc_m" inputmode="decimal" placeholder="‡πÄ‡∏°‡∏ï‡∏£" disabled>
                <div class="iq-sub">70 ‡∏ö‡∏≤‡∏ó/‡πÄ‡∏°‡∏ï‡∏£</div>
              </div>
            </div>

            <div class="iq-grid2">
              <div>
                <div class="label">‡∏ï‡∏±‡πâ‡∏á‡∏ô‡∏±‡πà‡∏á‡∏£‡πâ‡∏≤‡∏ô</div>
                <select id="scaffold">
                  <option value="none">‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ</option>
                  <option value="3-5">‡∏™‡∏π‡∏á 3‚Äì5 ‡πÄ‡∏°‡∏ï‡∏£ (1,000)</option>
                  <option value="6-8">‡∏™‡∏π‡∏á 6‚Äì8 ‡πÄ‡∏°‡∏ï‡∏£ (2,000)</option>
                </select>
              </div>
              <div>
                <div class="label">‡∏Å‡∏£‡∏¥‡∏ß‡∏õ‡∏£‡∏±‡∏ö‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á‡∏•‡∏°</div>
                <select id="grill">
                  <option value="none">‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ</option>
                  <option value="small">‡πÄ‡∏•‡πá‡∏Å (1,200)</option>
                  <option value="medium">‡∏Å‡∏•‡∏≤‡∏á (1,500)</option>
                  <option value="large1800">‡πÉ‡∏´‡∏ç‡πà (1,800)</option>
                  <option value="large2000">‡πÉ‡∏´‡∏ç‡πà (2,000)</option>
                </select>
              </div>
            </div>

            <div class="iq-grid2">
              <div>
                <div class="label">‡∏Å‡∏≤‡∏•‡∏±‡∏Å‡∏ô‡πâ‡∏≥</div>
                <select id="siphon">
                  <option value="none">‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ</option>
                  <option value="auto">‡∏ï‡∏≤‡∏° BTU</option>
                </select>
                <div class="iq-sub">9,000‚Äì24,000 = 2,500 | 30,000‚Äì60,000 = 4,000</div>
              </div>
            </div>
          </div>
        </div>

        <div class="card iq-step">
          <h2>Result: Breakdown</h2>
          <div id="result_box">
            <div class="iq-sub">‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö ‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</div>
          </div>
          <div class="iq-actions" style="margin-top:12px;">
            <button id="btn_copy" class="primary" type="button">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏™‡∏£‡∏∏‡∏õ</button>
            <button id="btn_reset" class="secondary" type="button">üîÑ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÉ‡∏´‡∏°‡πà</button>
          </div>
          <div id="copy_status" class="iq-sub" style="margin-top:10px;display:none;"></div>
        </div>

        <div class="card iq-step">
          <h2>‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</h2>
          <div class="iq-sub" style="margin-bottom:10px;color:var(--iq-text);font-weight:800;">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÅ‡∏•‡∏∞‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏≠‡∏≤‡∏Å‡∏≤‡∏® üîß</div>
          <div class="iq-note" style="padding:12px;border-radius:16px;border:1px solid var(--iq-border);">
            <div style="font-weight:900;color:var(--iq-text);margin-bottom:6px;">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∏‡∏î‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô (‡∏£‡∏ß‡∏°‡πÅ‡∏•‡πâ‡∏ß/‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á)</div>
            <ul style="margin:0;padding-left:18px;line-height:1.7;color:var(--iq-text);">
              <li>‡∏ó‡πà‡∏≠‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡πÅ‡∏≠‡∏£‡πå ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß 4 ‡πÄ‡∏°‡∏ï‡∏£</li>
              <li>‡∏™‡∏≤‡∏¢‡πÑ‡∏ü ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß 8 ‡πÄ‡∏°‡∏ï‡∏£</li>
              <li>‡∏ó‡πà‡∏≠‡∏ô‡πâ‡∏≥‡∏ó‡∏¥‡πâ‡∏á ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß 8 ‡πÄ‡∏°‡∏ï‡∏£</li>
              <li>‡πÄ‡∏ö‡∏£‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå 1 ‡∏ä‡∏∏‡∏î</li>
              <li>‡∏£‡∏≤‡∏á‡∏Ñ‡∏£‡∏≠‡∏ö‡∏ó‡πà‡∏≠ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß 4 ‡πÄ‡∏°‡∏ï‡∏£</li>
              <li>‡∏Ç‡∏≤‡∏¢‡∏≤‡∏á‡∏£‡∏≠‡∏á ‡πÅ‡∏•‡∏∞‡∏Ç‡∏≤‡πÄ‡∏´‡∏•‡πá‡∏Å‡∏ä‡∏∏‡∏î‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô</li>
            </ul>
          </div>
          <div style="height:10px"></div>
          <div style="font-weight:900;color:var(--iq-text);margin-bottom:6px;">‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á</div>
          <ul style="margin:0;padding-left:18px;line-height:1.7;color:var(--iq-text);">
            <li>‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡πà‡∏≠‡∏ô‡πâ‡∏≥‡∏¢‡∏≤ ‡∏ó‡πà‡∏≠‡∏ô‡πâ‡∏≥‡∏ó‡∏¥‡πâ‡∏á ‡πÅ‡∏•‡∏∞‡∏™‡∏≤‡∏¢‡πÑ‡∏ü ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏•‡∏≠‡∏¢ (‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô)</li>
            <li>‡∏Å‡∏£‡∏ì‡∏µ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏£‡∏µ‡∏î‡∏ú‡∏ô‡∏±‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ù‡∏±‡∏á‡∏ó‡πà‡∏≠ ‡∏Ñ‡∏¥‡∏î‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏° ‡πÄ‡∏°‡∏ï‡∏£‡∏•‡∏∞ 300 ‡∏ö‡∏≤‡∏ó</li>
            <li>‡∏Å‡∏£‡∏ì‡∏µ‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡πà‡∏≠‡∏Ç‡∏∂‡πâ‡∏ô‡∏ù‡πâ‡∏≤ ‡∏Ñ‡∏¥‡∏î‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏° ‡πÄ‡∏°‡∏ï‡∏£‡∏•‡∏∞ 300 ‡∏ö‡∏≤‡∏ó</li>
            <li>‡∏á‡∏≤‡∏ô‡πÄ‡∏î‡∏¥‡∏ô‡∏™‡∏≤‡∏¢‡πÑ‡∏ü‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡πÑ‡∏ü ‡∏à‡∏≤‡∏Å‡∏Ñ‡∏≠‡∏¢‡∏•‡πå‡∏£‡πâ‡∏≠‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏Ñ‡∏≠‡∏¢‡∏•‡πå‡πÄ‡∏¢‡πá‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (‡πÑ‡∏°‡πà‡∏£‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡πÄ‡∏î‡∏¥‡∏ô‡πÑ‡∏ü‡πÄ‡∏°‡∏ô‡∏à‡∏≤‡∏Å‡∏ï‡∏π‡πâ‡πÑ‡∏ü‡∏´‡∏•‡∏±‡∏Å)</li>
            <li>‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏à‡∏≤‡∏Å‡∏á‡∏≤‡∏ô‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô ‡∏ï‡∏±‡∏î‡∏ó‡∏≠‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡∏≠‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡πÑ‡∏î‡πâ</li>
            <li>‡∏Å‡∏£‡∏ì‡∏µ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ó‡πà‡∏≠‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏î‡πâ ‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏ô‡πâ‡∏≥‡∏¢‡∏≤ ‡∏Ç‡∏≠‡∏™‡∏á‡∏ß‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÑ‡∏°‡πà‡∏™‡πà‡∏á‡∏°‡∏≠‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏ô</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <div id="iq_sticky" class="iq-stickybar" role="region" aria-label="‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏ö‡∏ö‡∏¢‡πà‡∏≠">
    <button id="sticky_toggle" class="toggle" type="button" aria-label="‡∏¢‡πà‡∏≠/‡∏Ç‡∏¢‡∏≤‡∏¢‡∏™‡∏£‡∏∏‡∏õ">‚ñæ</button>
    <div class="sum">
      <div class="line">‡∏£‡∏ß‡∏°/‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á: <b id="sticky_per">-</b> ‚Ä¢ ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <b id="sticky_grand">-</b></div>
      <div class="line">BTU(‡∏Ñ‡∏¥‡∏î): <b id="sticky_btu">-</b> ‚Ä¢ ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á: <b id="sticky_count">1</b></div>
    </div>
    <div class="btns">
      <button id="sticky_reset" class="secondary" type="button">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
      <button id="sticky_copy" class="primary" type="button">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏™‡∏£‡∏∏‡∏õ</button>
    </div>
  </div>

  <script src="/assets/js/install_quote.js"></script>
  <script>
    (function(){
      "use strict";
      const $ = (id)=>document.getElementById(id);
      const fmt = (n)=> (Number.isFinite(Number(n)) ? Number(n).toLocaleString('th-TH') : '-');
      const money = (n)=> (Number.isFinite(Number(n)) ? Math.round(Number(n)).toLocaleString('th-TH') : '-');
      const qty = (n)=>{
        try{
          if(window.InstallQuote && InstallQuote._fmt && typeof InstallQuote._fmt.formatQty==='function'){
            return InstallQuote._fmt.formatQty(n,'m');
          }
          return String(n||0);
        }catch(e){ return String(n||0); }
      };

      let state = {
        ac_type: '‡∏ï‡∏¥‡∏î‡∏ú‡∏ô‡∏±‡∏á',
        btu_mode: 'manual',
        btu: 0,
        room_mode: 'area',
      };

    
      // sticky collapse (‡∏Å‡∏±‡∏ô‡∏ö‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠)
      const stickyBar = document.querySelector('.iq-stickybar');
      const stickyToggle = $('sticky_toggle');
      const setStickyCollapsed = (collapsed)=>{
        if(!stickyBar) return;
        stickyBar.classList.toggle('is-collapsed', !!collapsed);
        stickyToggle.textContent = collapsed ? '‚ñ∏' : '‚ñæ';
        stickyToggle.setAttribute('aria-expanded', collapsed ? 'false' : 'true');
        try{ localStorage.setItem('iq_sticky_collapsed', collapsed ? '1':'0'); }catch(e){}
      };
      let initCollapsed = false;
      try{ initCollapsed = (localStorage.getItem('iq_sticky_collapsed')==='1'); }catch(e){}
      if(window.innerHeight && window.innerHeight < 720) initCollapsed = true;
      if(window.innerWidth && window.innerWidth < 390) initCollapsed = true;
      setStickyCollapsed(initCollapsed);

      if(stickyToggle){
        stickyToggle.addEventListener('click', ()=>{
          const now = stickyBar.classList.contains('is-collapsed');
          setStickyCollapsed(!now);
        });
      }

  // chips
      document.querySelectorAll('[data-ac-type]').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const v = btn.getAttribute('data-ac-type');
          state.ac_type = v;
          document.querySelectorAll('[data-ac-type]').forEach(b=>b.setAttribute('aria-pressed', String(b===btn)));
          recalc();
        });
      });

      document.querySelectorAll('[data-btu-mode]').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const v = btn.getAttribute('data-btu-mode');
          state.btu_mode = v;
          document.querySelectorAll('[data-btu-mode]').forEach(b=>b.setAttribute('aria-pressed', String(b===btn)));
          $('btu_manual_box').style.display = (v==='manual') ? '' : 'none';
          $('btu_room_box').style.display = (v==='room') ? '' : 'none';
          $('btu_warn').classList.remove('show');
          recalc();
        });
      });

      // room input mode chips (‡∏ï‡∏£.‡∏°. / ‡∏Å‡∏ß‡πâ‡∏≤‡∏á√ó‡∏¢‡∏≤‡∏ß)
      const setRoomMode = (mode)=>{
        state.room_mode = mode;
        document.querySelectorAll('[data-room-mode]').forEach(b=>b.setAttribute('aria-pressed', String(b.getAttribute('data-room-mode')===mode)));
        $('room_area_box').style.display = (mode==='area') ? '' : 'none';
        $('room_wh_box').style.display = (mode==='wh') ? '' : 'none';
        updateRoomAreaCalc();
        recalc();
      };
      document.querySelectorAll('[data-room-mode]').forEach(btn=>{
        btn.addEventListener('click', ()=> setRoomMode(btn.getAttribute('data-room-mode')));
      });

      function updateRoomAreaCalc(){
        if(state.room_mode !== 'wh'){
          $('room_area_calc').textContent = '-';
          return;
        }
        const w = InstallQuote._util.toNumber($('room_w').value, {min:0,max:200,decimals:2});
        const l = InstallQuote._util.toNumber($('room_l').value, {min:0,max:200,decimals:2});
        const area = w && l ? (w*l) : 0;
        $('room_area_calc').textContent = area ? (area.toFixed(2).replace(/\.00$/,'').replace(/(\.[1-9])0$/,'$1') + ' ‡∏ï‡∏£.‡∏°.') : '-';
      }

      // machine count stepper
      const setCount = (n)=>{
        const v = Math.max(1, Math.min(50, parseInt(n||'1',10)||1));
        $('machine_count').value = String(v);
        $('mc_value').textContent = String(v);
        $('kpi_count').textContent = String(v);
        $('sticky_count').textContent = String(v);
        recalc();
      };
      $('mc_minus').addEventListener('click', ()=> setCount((parseInt($('machine_count').value,10)||1)-1));
      $('mc_plus').addEventListener('click', ()=> setCount((parseInt($('machine_count').value,10)||1)+1));

      // special toggles
      const bindToggle = (chkId, inputId)=>{
        const chk = $(chkId);
        const inp = $(inputId);
        chk.addEventListener('change', ()=>{
          inp.disabled = !chk.checked;
          if(!chk.checked) inp.value = '';
          recalc();
        });
        inp.addEventListener('input', recalc);
      };
      bindToggle('chk_wall_chase','wall_chase_m');
      bindToggle('chk_ceiling_run','ceiling_run_m');
      bindToggle('chk_misc_parts','misc_parts_qty');
      bindToggle('chk_wire_tray','wire_tray_m');
      bindToggle('chk_pvc','pvc_m');

      // thick insulation depends on ceiling run
      const syncInsulation = ()=>{
        const ceilingOn = $('chk_ceiling_run').checked;
        $('chk_thick_insulation').disabled = !ceilingOn;
        if(!ceilingOn){
          $('chk_thick_insulation').checked = false;
          $('thick_insulation_m').value = '';
          $('thick_insulation_m').disabled = true;
        } else {
          $('thick_insulation_m').disabled = !$('chk_thick_insulation').checked;
        }
      };
      $('chk_ceiling_run').addEventListener('change', ()=>{ syncInsulation(); recalc(); });
      $('chk_thick_insulation').addEventListener('change', ()=>{ $('thick_insulation_m').disabled = !$('chk_thick_insulation').checked; if(!$('chk_thick_insulation').checked) $('thick_insulation_m').value=''; recalc(); });
      $('thick_insulation_m').addEventListener('input', recalc);
      syncInsulation();

      // standard inputs
      ['btu_input','len_ref','len_power','len_drain','len_trunk','room_area','room_w','room_l'].forEach(id=>$(id).addEventListener('input', ()=>{ if(id==='room_w' || id==='room_l') updateRoomAreaCalc(); recalc(); }));
      $('room_factor').addEventListener('change', recalc);
      ['scaffold','grill','siphon'].forEach(id=>$(id).addEventListener('change', recalc));

      // btu normalize helpers
      function setBtuValue(btu){
        const v = Math.max(0, Math.min(200000, parseInt(btu||'0',10)||0));
        state.btu = v;
        const txt = v ? fmt(v) : '-';
        $('kpi_btu').textContent = txt;
        $('sticky_btu').textContent = txt;
      }

      $('use_norm_btu').addEventListener('click', ()=>{
        const raw = InstallQuote._util.toNumber($('btu_input').value, {min:0,max:200000,decimals:0});
        const norm = InstallQuote.normalizeBtu(raw);
        $('btu_input').value = norm ? String(norm) : '';
        setBtuValue(norm);
        $('btu_warn').classList.remove('show');
        recalc();
      });

      $('use_room_btu').addEventListener('click', ()=>{
        const area = getRoomAreaForCalc();
        const factor = InstallQuote._util.toNumber($('room_factor').value, {min:700,max:900,decimals:0});
        const r = InstallQuote.calcBtuFromRoom(area, factor);
        if(r.normalized_btu){
          $('btu_input').value = String(r.normalized_btu);
          setBtuValue(r.normalized_btu);
          $('btu_warn').classList.remove('show');
        }
        recalc();
      });

      function buildBreakdownHtml(b){
        const per = money(b.totals.per_machine);
        const grand = money(b.totals.grand);
        $('kpi_per').textContent = per==='-'? '-' : per + ' ‡∏ø';
        $('kpi_grand').textContent = grand==='-'? '-' : grand + ' ‡∏ø';
        // sticky summary
        $('sticky_per').textContent = per==='-'? '-' : per + ' ‡∏ø';
        $('sticky_grand').textContent = grand==='-'? '-' : grand + ' ‡∏ø';
        $('sticky_btu').textContent = $('kpi_btu').textContent || '-';
        $('sticky_count').textContent = $('kpi_count').textContent || '1';

        const extrasRows = b.extras.lines.map(x=>{
          if(x.key==='drain'){
            const extraTxt = x.extra_m>0 ? `‡πÄ‡∏Å‡∏¥‡∏ô ${qty(x.extra_m)}m` : '‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô';
            return `<tr><td>${x.label}<div class="iq-sub">${extraTxt} ‚Ä¢ ${x.note}</div></td><td>${money(0)} ‡∏ø</td></tr>`;
          }
          const extraTxt = x.extra_m>0 ? `‡πÄ‡∏Å‡∏¥‡∏ô ${qty(x.extra_m)}m x ${money(x.rate)}/m` : '‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô (0 ‡∏ö‡∏≤‡∏ó)';
          return `<tr><td>${x.label}<div class="iq-sub">${extraTxt}</div></td><td>${money(x.cost)} ‡∏ø</td></tr>`;
        }).join('');

        const fmtQtyUnit = (v,u)=>{
          try{
            if(window.InstallQuote && InstallQuote._fmt && typeof InstallQuote._fmt.formatQty==='function'){
              return InstallQuote._fmt.formatQty(v,u);
            }
            return String(v||0);
          }catch(e){ return String(v||0); }
        };

        const specialsRows = (b.specials.lines.length?
          b.specials.lines.map(s=>`<tr><td>${s.label}<div class="iq-sub">${fmtQtyUnit(s.qty,s.unit)}${s.unit} x ${money(s.rate)}</div></td><td>${money(s.cost)} ‡∏ø</td></tr>`).join('')
          : `<tr><td class="iq-muted">‡πÑ‡∏°‡πà‡∏°‡∏µ</td><td>${money(0)} ‡∏ø</td></tr>`
        );

        return `
          <div class="iq-grid" style="gap:8px;">
            <div class="iq-badge"><span class="iq-muted">‡πÄ‡∏£‡∏ó‡∏ó‡πà‡∏≠‡∏ô‡πâ‡∏≥‡∏¢‡∏≤/‡∏™‡∏≤‡∏¢‡πÑ‡∏ü‡∏ï‡∏≤‡∏° BTU:</span><b>‡∏ó‡πà‡∏≠‡∏ô‡πâ‡∏≥‡∏¢‡∏≤ ${money(b.meta.rates.ref_per_m)}/m ‚Ä¢ ‡∏™‡∏≤‡∏¢‡πÑ‡∏ü ${money(b.meta.rates.power_per_m)}/m</b></div>
            <div class="iq-hr"></div>
            <div><b>1) ‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô</b><div class="iq-sub">‡∏ä‡πà‡∏ß‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤ ${b.base_labor.range_label} ‡∏ö‡∏≤‡∏ó ‚Ä¢ ‡πÉ‡∏ä‡πâ STD = <b>${money(b.base_labor.std)}</b> ‡∏ö‡∏≤‡∏ó/‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</div></div>
            <table class="iq-table"><tr><td>‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á (STD)</td><td>${money(b.base_labor.std)} ‡∏ø</td></tr></table>

            <div class="iq-hr"></div>
            <div><b>2) ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏ß‡∏°‡πÅ‡∏•‡πâ‡∏ß/‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</b>
              <div class="iq-sub">‡∏ó‡πà‡∏≠‡∏ô‡πâ‡∏≥‡∏¢‡∏≤ 4m ‚Ä¢ ‡∏™‡∏≤‡∏¢‡πÑ‡∏ü 8m ‚Ä¢ ‡∏ó‡πà‡∏≠‡∏ô‡πâ‡∏≥‡∏ó‡∏¥‡πâ‡∏á 8m ‚Ä¢ ‡πÄ‡∏ö‡∏£‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå 1 ‡∏ä‡∏∏‡∏î ‚Ä¢ ‡∏£‡∏≤‡∏á‡∏Ñ‡∏£‡∏≠‡∏ö‡∏ó‡πà‡∏≠ 4m ‚Ä¢ ‡∏Ç‡∏≤‡∏¢‡∏≤‡∏á‡∏£‡∏≠‡∏á/‡∏Ç‡∏≤‡πÄ‡∏´‡∏•‡πá‡∏Å‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô</div>
            </div>

            <div class="iq-hr"></div>
            <div><b>3) ‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡∏à‡∏≤‡∏Å‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô</b></div>
            <table class="iq-table">${extrasRows}<tr><td><b>‡∏£‡∏ß‡∏°‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô</b></td><td><b>${money(b.extras.total)} ‡∏ø</b></td></tr></table>

            <div class="iq-hr"></div>
            <div><b>4) ‡∏á‡∏≤‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©/‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏û‡∏¥‡πà‡∏°</b></div>
            <table class="iq-table">${specialsRows}<tr><td><b>‡∏£‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©</b></td><td><b>${money(b.specials.total)} ‡∏ø</b></td></tr></table>

            <div class="iq-hr"></div>
            <table class="iq-table">
              <tr><td><b>5) ‡∏£‡∏ß‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</b></td><td><b>${money(b.totals.per_machine)} ‡∏ø</b></td></tr>
              <tr><td><b>‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (${fmt(b.meta.machine_count)} ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á)</b></td><td><b>${money(b.totals.grand)} ‡∏ø</b></td></tr>
            </table>
          </div>
        `;
      }

      function gather(){
        const machine_count = parseInt($('machine_count').value,10)||1;
        const btuManual = InstallQuote._util.toNumber($('btu_input').value, {min:0,max:200000,decimals:0});
        setBtuValue(btuManual);

        return {
          ac_type: state.ac_type,
          machine_count,
          btu: state.btu,
          len_ref: $('len_ref').value,
          len_power: $('len_power').value,
          len_drain: $('len_drain').value,
          len_trunk: $('len_trunk').value,
          wall_chase_m: $('chk_wall_chase').checked ? $('wall_chase_m').value : 0,
          ceiling_run_m: $('chk_ceiling_run').checked ? $('ceiling_run_m').value : 0,
          thick_insulation_m: ($('chk_ceiling_run').checked && $('chk_thick_insulation').checked) ? $('thick_insulation_m').value : 0,
          misc_parts_qty: $('chk_misc_parts').checked ? $('misc_parts_qty').value : 0,
          wire_tray_m: $('chk_wire_tray').checked ? $('wire_tray_m').value : 0,
          pvc_m: $('chk_pvc').checked ? $('pvc_m').value : 0,
          scaffold: $('scaffold').value,
          grill: $('grill').value,
          siphon: $('siphon').value,
        };
      }

      function updateBtuBadges(){
        const raw = InstallQuote._util.toNumber($('btu_input').value, {min:0,max:200000,decimals:0});
        const norm = InstallQuote.normalizeBtu(raw);
        $('btu_norm_badge').textContent = norm ? fmt(norm) : '-';

        const area = getRoomAreaForCalc();
        const factor = InstallQuote._util.toNumber($('room_factor').value, {min:700,max:900,decimals:0});
        const r = InstallQuote.calcBtuFromRoom(area, factor);
        $('btu_raw').textContent = r.raw_btu ? fmt(r.raw_btu) : '-';
        $('btu_norm').textContent = r.normalized_btu ? fmt(r.normalized_btu) : '-';
      }

      function getRoomAreaForCalc(){
        if(state.room_mode === 'wh'){
          const w = InstallQuote._util.toNumber($('room_w').value, {min:0,max:200,decimals:2});
          const l = InstallQuote._util.toNumber($('room_l').value, {min:0,max:200,decimals:2});
          return w && l ? (w*l) : 0;
        }
        return InstallQuote._util.toNumber($('room_area').value, {min:0,max:1000,decimals:2});
      }

      let lastBreakdown = null;

      function recalc(){
        updateBtuBadges();
        const input = gather();
        // KPI BTU will be updated again after calcQuote() (uses normalized BTU for pricing)
        $('kpi_btu').textContent = input.btu ? fmt(input.btu) : '-';

        // validation
        if(!input.btu){
          $('btu_warn').classList.add('show');
          $('result_box').innerHTML = '<div class="iq-sub">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà BTU ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏Ñ‡∏≤</div>';
          $('kpi_per').textContent = '-';
          $('kpi_grand').textContent = '-';
          lastBreakdown = null;
          return;
        }
        $('btu_warn').classList.remove('show');

        const b = InstallQuote.calcQuote(input);
        lastBreakdown = b;
        // Show BTU that is actually used for calculation (normalized)
        if (b && b.meta && b.meta.btu_used) {
          $('kpi_btu').textContent = fmt(b.meta.btu_used);
        }
        $('result_box').innerHTML = buildBreakdownHtml(b);
      }

      async function copyText(text){
        // robust clipboard with fallback
        try{
          if(navigator.clipboard && window.isSecureContext){
            await navigator.clipboard.writeText(text);
            return true;
          }
        }catch(e){/* fall through */}
        try{
          const ta = document.createElement('textarea');
          ta.value = text;
          ta.setAttribute('readonly','');
          ta.style.position='fixed';
          ta.style.top='-9999px';
          document.body.appendChild(ta);
          ta.select();
          const ok = document.execCommand('copy');
          document.body.removeChild(ta);
          return !!ok;
        }catch(e){
          return false;
        }
      }

      $('btn_copy').addEventListener('click', async ()=>{
        const box = $('copy_status');
        if(!lastBreakdown){
          box.style.display='block';
          box.textContent='‚ö†Ô∏è ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÉ‡∏´‡πâ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å (‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å BTU ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)';
          return;
        }
        const text = InstallQuote.formatQuoteForCopy(lastBreakdown);
        const ok = await copyText(text);
        box.style.display='block';
        box.textContent = ok ? '‚úÖ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß (‡∏ô‡∏≥‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡πÉ‡∏ô‡πÅ‡∏ä‡∏ó/‡πÑ‡∏•‡∏ô‡πå‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢)' : '‚ùå ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡∏•‡∏≠‡∏á‡∏Å‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å)';
      });

      $('btn_reset').addEventListener('click', ()=>{
        // keep safe: only reset fields in this page
        state.ac_type = '‡∏ï‡∏¥‡∏î‡∏ú‡∏ô‡∏±‡∏á';
        state.btu_mode = 'manual';
        state.btu = 0;
        state.room_mode = 'area';

      
      // sticky collapse (‡∏Å‡∏±‡∏ô‡∏ö‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠)
      const stickyBar = document.querySelector('.iq-stickybar');
      const stickyToggle = $('sticky_toggle');
      const setStickyCollapsed = (collapsed)=>{
        if(!stickyBar) return;
        stickyBar.classList.toggle('is-collapsed', !!collapsed);
        stickyToggle.textContent = collapsed ? '‚ñ∏' : '‚ñæ';
        stickyToggle.setAttribute('aria-expanded', collapsed ? 'false' : 'true');
        try{ localStorage.setItem('iq_sticky_collapsed', collapsed ? '1':'0'); }catch(e){}
      };
      let initCollapsed = false;
      try{ initCollapsed = (localStorage.getItem('iq_sticky_collapsed')==='1'); }catch(e){}
      if(window.innerHeight && window.innerHeight < 720) initCollapsed = true;
      if(window.innerWidth && window.innerWidth < 390) initCollapsed = true;
      setStickyCollapsed(initCollapsed);

      if(stickyToggle){
        stickyToggle.addEventListener('click', ()=>{
          const now = stickyBar.classList.contains('is-collapsed');
          setStickyCollapsed(!now);
        });
      }

  // chips reset
        document.querySelectorAll('[data-ac-type]').forEach(b=>b.setAttribute('aria-pressed', String(b.getAttribute('data-ac-type')==='‡∏ï‡∏¥‡∏î‡∏ú‡∏ô‡∏±‡∏á')));
        document.querySelectorAll('[data-btu-mode]').forEach(b=>b.setAttribute('aria-pressed', String(b.getAttribute('data-btu-mode')==='manual')));
        document.querySelectorAll('[data-room-mode]').forEach(b=>b.setAttribute('aria-pressed', String(b.getAttribute('data-room-mode')==='area')));
        $('btu_manual_box').style.display='';
        $('btu_room_box').style.display='none';
        $('room_area_box').style.display='';
        $('room_wh_box').style.display='none';
        setCount(1);

        ['btu_input','len_ref','len_power','len_drain','len_trunk','room_area','room_w','room_l','wall_chase_m','ceiling_run_m','thick_insulation_m','misc_parts_qty','wire_tray_m','pvc_m'].forEach(id=>{ $(id).value=''; });
        
      // stickybar actions
      $('sticky_copy').addEventListener('click', ()=> $('btn_copy').click());
      $('sticky_reset').addEventListener('click', ()=> $('btn_reset').click());
updateRoomAreaCalc();
        ['chk_wall_chase','chk_ceiling_run','chk_thick_insulation','chk_misc_parts','chk_wire_tray','chk_pvc'].forEach(id=>{ $(id).checked=false; });
        ['scaffold','grill','siphon'].forEach(id=>{ $(id).value='none'; });
        ['wall_chase_m','ceiling_run_m','thick_insulation_m','misc_parts_qty','wire_tray_m','pvc_m'].forEach(id=>{ $(id).disabled=true; });
        syncInsulation();
        $('copy_status').style.display='none';
        $('btu_warn').classList.remove('show');
        recalc();
      });

      // initial paint
      setCount(1);
      recalc();
    })();
  </script>

</body>
</html>
